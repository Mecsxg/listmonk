import{V as l,m as o,n}from"./index-id_R8LyY.js";import{E as r}from"./EmptyPlaceholder-DaKCsmPq.js";const d=l.extend({components:{EmptyPlaceholder:r},name:"Media",props:{isModal:Boolean,type:{type:String,default:""}},data(){return{form:{files:[]},toUpload:0,uploaded:0,queryParams:{page:1,query:""}}},methods:{removeUploadFile(i){this.form.files.splice(i,1)},getMedia(){this.$api.getMedia({page:this.queryParams.page,query:this.queryParams.query})},onQueryMedia(){this.queryParams.page=1,this.getMedia()},onMediaSelect(i,e){this.isModal&&(e.preventDefault(),this.$emit("selected",i),this.$parent.close())},onSubmit(){this.toUpload=this.form.files.length;for(let i=0;i<this.toUpload;i+=1){const e=new FormData;e.set("file",this.form.files[i]),this.$api.uploadMedia(e).then(()=>{this.onUploaded()},()=>{this.onUploaded()})}},onDeleteMedia(i){this.$api.deleteMedia(i).then(()=>{this.getMedia()})},onUploaded(){this.uploaded+=1,this.uploaded>=this.toUpload&&(this.toUpload=0,this.uploaded=0,this.form.files=[],this.getMedia())},onPageChange(i){this.queryParams.page=i,this.getMedia()}},computed:{...o(["loading","media","settings"]),isProcessing(){return this.toUpload>0&&this.uploaded<this.toUpload}},mounted(){this.$api.getMedia()}});var u=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("section",{staticClass:"media-files"},[t("h1",{staticClass:"title is-4"},[e._v(" "+e._s(e.$t("media.title"))+" "),e.media.length>0?t("span",[e._v("("+e._s(e.media.length)+")")]):e._e(),t("span",{staticClass:"has-text-grey-light"},[e._v(" / "+e._s(e.settings["upload.provider"]))])]),t("b-loading",{attrs:{active:e.isProcessing||e.loading.media}}),t("section",{staticClass:"wrap"},[t("form",{staticClass:"box",on:{submit:function(a){return a.preventDefault(),e.onSubmit.apply(null,arguments)}}},[t("div",[t("b-field",{attrs:{label:e.$t("media.uploadImage")}},[t("b-upload",{attrs:{"drag-drop":"",multiple:"",xaccept:".png,.jpg,.jpeg,.gif,.svg",expanded:""},model:{value:e.form.files,callback:function(a){e.$set(e.form,"files",a)},expression:"form.files"}},[t("div",{staticClass:"has-text-centered section"},[t("p",[t("b-icon",{attrs:{icon:"file-upload-outline",size:"is-large"}})],1),t("p",[e._v(e._s(e.$t("media.uploadHelp")))])])])],1),e.form.files.length>0?t("div",{staticClass:"tags"},e._l(e.form.files,function(a,s){return t("b-tag",{key:s,attrs:{size:"is-medium",closable:""},on:{close:function(p){return e.removeUploadFile(s)}}},[e._v(" "+e._s(a.name)+" ")])}),1):e._e(),t("div",{staticClass:"buttons"},[t("b-button",{attrs:{"native-type":"submit",type:"is-primary","icon-left":"file-upload-outline",disabled:e.form.files.length===0,loading:e.isProcessing}},[e._v(" "+e._s(e.$tc("media.upload"))+" ")])],1)],1)])]),t("section",{staticClass:"wrap gallery mt-6"},[t("b-table",{attrs:{data:e.media.results,hoverable:!0,loading:e.loading.media,"default-sort":"createdAt",paginated:!0,"backend-pagination":"","pagination-position":"both","current-page":e.media.page,"per-page":e.media.perPage,total:e.media.total},on:{"page-change":e.onPageChange},scopedSlots:e._u([{key:"top-left",fn:function(){return[t("div",{staticClass:"columns"},[t("div",{staticClass:"column is-6"},[t("form",{on:{submit:function(a){return a.preventDefault(),e.onQueryMedia.apply(null,arguments)}}},[t("div",[t("b-field",[t("b-input",{ref:"query",attrs:{name:"query",expanded:"",icon:"magnify","data-cy":"query"},model:{value:e.queryParams.query,callback:function(a){e.$set(e.queryParams,"query",a)},expression:"queryParams.query"}}),t("p",{staticClass:"controls"},[t("b-button",{attrs:{"native-type":"submit",type:"is-primary","icon-left":"magnify","data-cy":"btn-query"}})],1)],1)],1)])])])]},proxy:!0},e.loading.media?null:{key:"empty",fn:function(){return[t("empty-placeholder")]},proxy:!0}],null,!0)},[t("b-table-column",{attrs:{field:"name",width:"40%",label:e.$t("globals.fields.name")},scopedSlots:e._u([{key:"default",fn:function(a){return[t("a",{staticClass:"link",attrs:{href:a.row.url,target:"_blank",rel:"noopener noreferer",title:a.row.filename},on:{click:s=>e.onMediaSelect(a.row,s)}},[e._v(" "+e._s(a.row.filename)+" ")])]}}])}),t("b-table-column",{attrs:{field:"thumb",width:"30%"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("a",{staticClass:"thumb box",attrs:{href:a.row.url,target:"_blank",rel:"noopener noreferer"},on:{click:s=>e.onMediaSelect(a.row,s)}},[a.row.thumbUrl?t("img",{attrs:{src:a.row.thumbUrl,title:a.row.filename,alt:""}}):t("span",{staticClass:"ext"},[e._v(" "+e._s(a.row.filename.split(".").pop())+" ")])])]}}])}),t("b-table-column",{attrs:{field:"created_at",width:"25%",label:e.$t("globals.fields.createdAt"),sortable:""},scopedSlots:e._u([{key:"default",fn:function(a){return[e._v(" "+e._s(e.$utils.niceDate(a.row.createdAt,!0))+" ")]}}])}),t("b-table-column",{attrs:{field:"actions",width:"5%","cell-class":"has-text-right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("a",{attrs:{href:"#","data-cy":"btn-delete","aria-label":e.$t("globals.buttons.delete")},on:{click:function(s){s.preventDefault(),e.$utils.confirm(null,()=>e.onDeleteMedia(a.row.id))}}},[t("b-tooltip",{attrs:{label:e.$t("globals.buttons.delete"),type:"is-dark"}},[t("b-icon",{attrs:{icon:"trash-can-outline",size:"is-small"}})],1)],1)]}}])})],1)],1)],1)},c=[],m=n(d,u,c);const h=m.exports;export{h as default};
